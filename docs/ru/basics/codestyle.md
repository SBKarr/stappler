Title: Стиль кода
Priority: 0
# Стиль кода

{{TOC}}

Стиль кода Stappler направлен на упрощение разработки и интеграции различных компонентов и соцетает в себе некоторые исторические элементы из Objective-С (для которого был создан исходный проект) и современных приёмов, характерный для Modern C++

## Одноуровневое включение заголовоков
Код Stappler внутри компонентов логически разделён на директории, однако при включении файлов нет необходимости указывать путь к его директории:
```cpp
#include "SPCommon.h"
// а не
#include "common/core/SPCommon.h"
```
Вместо этого, компоненты используют префиксы файлов:

**SP** - компоненты Common и Stappler

**SL** - компонент Layout

**SE** - компонент Serenity

**ST** - компонент Stellator

**SPug** - компонент SPug

**Material** - компонент Material

**MMD** - компонент Document, имплементация Multimarkdown

**Epub** - компонент Document, имплементация Epub

**OD** - компонент Document, имплементация OpenDocument

**RT** - компонент Document, имплементация графический компонентов текста (RichText)

**XL** - компонент Xenolith

Сборочная система автоматически настраивает пути включения таким образом, чтобы для файлов не приходилось указывать путь к их директории, если заголовочный файл доступен в наборе инструментов.

Аналогично работает система включения файлов в проектах при использовании `LOCAL_INCLUDES_DIRS`. Все поддиректории раскрываются таким образом, чтобы включаемые файлы были доступны без указания полного пути к ним.

## Single compilation unit
[SCU](https://en.wikipedia.org/wiki/Single_Compilation_Unit) - подход, позволяющий ускорить компиляцию и более широко применять оптимизации компилятора ценой большего расхода оперативной памяти на компиляцию.

Stappler определяет несколько SCU в каждом компоненте, балансируя между скоростью компиляции, расходом памяти и возможностями многопоточной компиляции.

Система сборки автоматически считает файлы `.cpp` и `.c` юнитами компиляции, а `.cc` - включаемыми в SCU файлами исодного кода.

Кроме того, для ускорения компиляции использутся предкомпиляция общих заголовков компонентов. Чтобы использовать это преимущество, нужно первым заголовочным файлом в юните компиляции подключать один из следующих:

```
#include "SPCommon.h" // компонент Common
#include "SPLayout.h" // компонент Layout
#include "SPDefine.h" // компонент Stappler
#include "Define.h" // компонент Serenity
#include "STDefine.h" // компонент Stellator
#include "Material.h" // компонент Material
#include "XLDefine.h" // компонент Xenolith
```

## Namespaces
Stappler использует неймспейсы в стиле C++17, за исключением случаев, когда неймспейс должен быть определён в зависимости от набора инстурментов (в случае Stellator/Serenity).

В случае небольших проектов и стандартного интерфейса памяти лучше всего использовать для проекта вложенный неймспейс вида:
```cpp
namespace stappler::project {
// ваш код
}
```

В больших проектах стоит использовать собственный неймспейс и импортировать в него необходимые компоненты памяти:
```cpp
namespace project {

using namespace stappler::mem_pool;

// ваш код
}
```
