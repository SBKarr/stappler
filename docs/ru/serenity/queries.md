# Запросы к ресурсам

{{TOC}}

## Включение/исключение полей

При запросе к ресурсу стоит явно указывать, какие поля необходимы в ответе, чтобы снизить нагрузку на БД и передачу данных. В случае, если поля не указаны, возвращаются открытые поля по умолчанию (то есть все, кроме полей, требующих подзапроса: файлов, списков, view и объектов, и принудительно исключённых ForceExcclude). Так же указание списка полей позволяет раскрывать вложенные поля с помощью подзапросов.

Для включения полей нужно передать параметр `fields`:

```
// Простаая форма:
 - fields: name, tags;

http://localhost/api/v1/objects?(fields:name,tags)

// Раскрытие вложенных полей (используется объект с разделителем ; вместо ,)
// На уровне, на котором нужно раскрывать подполя, разделителем будет ; 
// чтобы избежать конфликта со списком, где разделителем будет ,
- fields (
      name;
      tags;
      issues: $basics, content;
      articles (
          name;
          content: type, size;
      )
  )

http://localhost/api/v1/objects?(fields(name;tags;issues:$basics,content)articles(name;content:type,size)))
```

Специальные переменные в `include`:

`$defs`- Соответствует всем полям, для получения которых не нужны подзапросы

`$basics` - Соответствует простым полям ($default кроме типов Extra и Data)

`$objects` - Раскрывает поля типа Object

`$sets` - Раскрывает поля типа Set

`$arrays` - Раскрывает поля типа Array

`$ids` - Для нераскрытых полей вместо значений вернуть числовые идентификаторы

`$all` - Соответствует всем полям объекта

`$meta` - зарезервировано для метаданных

## Мягкий лимит (soft_limit/continue_token)

Мягкий лимит используется, чтобы ограничить нагрузку на БД и передачу при просмотре большого числа объектов. Эта техника позволяет возвращать некоторое число объектов вместе с указателем для продолжения перебора. Для начала выборки нужно использовать параметр `begin`:

```
// полная форма,с указанием поля для сортировки, минимального числа элементов
// и порядка сортировки (asc|desc)
(begin:mtime;25;asc)

// частичная форма без указания поля (в таком случае сортировка будет по полю __oid)
(begin:25;desc)

// частичная форма без порядка сортировки (использоваться будет asc)
(begin:mtime,25)

// только поле, будет выдаваться по 25 объектов в порядке asc
(begin:mtime)

// только количество, будет выбираться по __oid в порядке asc
(begin:50)

// можно комбинировать с другими параметрами
(begin:ctime,50;fields:mtime,name,title;pretty)
```

Мягкий лимит гарантирует, что будет получено не менее затребованного количества объектов (может вернуть больше). В ответе будет содержаться информация о курсоре, в том числе, указатели на следующую и предыдущую страницы:

```
{
	"cursor": {
		"count":10, // минимальное число элементов в выдаче
		"start":11, // индекс первого элемента (начинается с 1)
		"end":20, // индекс последнего элемента (максимум total)
		"field":"__oid", // поле сортировки
		"next":"2dn3hmVfX29pZBkFxAoUGSXPAA", // указатель на следущую страницу
		"prev":"2dn3hmVfX29pZBkFuwoKGSXPAg", // указатель на предыдущую страницу
		"total":9679 // всего элементов в БД
	}
}
```

Для получения следующей страницы нужно передать параметр `continue` вместо `begin` с указателем на предыдущую/следущую страницу. Указатели можно кешировать для перехода на конкретную уже полученную страницу.

```
// используем указатель
(continue:2dn3hmVfX29pZBkFxAoUGSXPAA;fields:mtime,name,title;pretty)
```

Мягкий лимит работает быстрее при запросе по встроенному полю `__oid`